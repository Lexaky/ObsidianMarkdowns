**Created at** [01-12-2025 15:20]
**Tags**: #Математическая_статистика
# Эффект множественных сравнений. Введение в дисперсионный анализ. Множественные сравнения после ANOVA


#### Рассматриваемое знание
Критерий Стьюдента для сравнения двух групп. Если большее количество - то у нас получается эффект множественных сравнений. Есть 3 выборки - нужно 3 раза сравнеивать через t-test. 4 выборки - 6 сравнений. Общая формула:
$$\frac{N(N-1)}{2}$$

Обычно задаётся уровнем значимости 0.05, можно и 0.01, но соотвественно вероятность ошибки 1-го рода будет 99%.
Если не ошибаемся, то эта вероятность в 3-х случаев 0.95^3 = 0,857
и 3 - это не предел, если подставить в формулу: вероятность отсутствия ошибки 1-го рода:
$$1 - (1-0.05)^m$$
Задаёмся уровнем значимости alpha = 0.05. Если сделаем 10 сравнений, то это сильно повлияет на результат.

(История про опыт с экстрасенсами)

Как сравнивать всё сразу?
Есть несколько групп, нужно разброс средних выборочных сравниваем с разбросом значений внутри групп. Это называется дисперсионным анализом. Важно распределение внутри групп, внутригрупповые дисперсии не должны отличаться.
Нулевая гипотеза - среднее во всех средних группах равны. Если хотя бы одна отличается (одно из равенств нарушено), то это альтернатива (другая гипотеза)

Строится 2 оценки дисперсии 
(слайд про однофакторный дисперсионный анализ)
Величина F должна быть близка к 1, распределение Фишера - это величина, составленная из частного двух дисперсий нормального распределения.
Распределения Фишера приведено, некоторый вариант его. Понятно, что значение может отличаться от 1, нужно просто сравнивать с распределением Фишера.

Формулы
MSW - внутригрупповая дисперсия (слушать запись, что происходит в формуле)
MSB - межгрупповая дисперсия. Есть общая средняя по всей выборке x с палкой, и средняя в каждой выборке xi с палкой. (слушать запись).
F = MSB/MSW

Межгрупповая (степени свободы) k-1, а внутригрупповая n-k.
Пример
Есть 3 группы людей с различным образом жизни.
Средние значения признака по группам: (11.5, 10.1, 9.1)
Выборочные стандартные отклонения:
(1.3, 2.1, 2.4)
Если выборок больше, чем 2 - сразу дисперсионный анализ. Отличаются ли средние в этих группах?
Групп 3, поэтому степеней свобод k-1 = 2.
А внутригрупповых наблюдений: n - k = 26*3 - 3 = 75
Среднее по всей выборке (11.5 + 10.1 + 9.1)/3 = 10.23
Внутри и междгрупповые суммы квадратов отклонений:
MSW = 296.5/75 = 3.95
MSB = 37.8
F = 37.8/3.95 = 9.56 // F(0.05, 2.75) = 3.12 - наш конечно больше, значит гипотезу отвергаем, что они одинаковые - они отличаются.

Если бы не отвергли 0-ю гипеотезу, то дальше ничего не делаем. А если отвергается - то анализ продолжается. Спорт влияет, нужно делать post-hoc анализ. Всё-равно мы делаем попарные сравнения, но учитываем ошибку 1-го рода.
Простейший - это поправка Бонферрони.
При большом количестве сравнений оно равно k * alpha. Мы можем просто уровень значимости на k делить.
Если хотим 0.95, то берём критерий для alpha = 0.05/3 (при 3-х группах).
Для небольших групп не сильно влияет, а для больших сильно снижает мощность метода.

Метод Холма - Бонферрони.
Исходные p значения упорядочиваем по возрастанию. Провели анализ, отличия увидели, сравним друг с другом попарно и получим p значения. Мы не сравниваем их с alpha/k (слишком маленьким значением), а сначала ранжируем. Каждую гипотезу пронумеруем, сравниваем их с p. Если p1 >= a/m. Дальше алгоритм на слайде с этим методом.


Пример:
Пусть есть 4 выборки. Сравнили 1 с 2, сравнили 1 с 3, сравнили 1 с 4.
Сравнили 2 с 3, сравнили 2 с 4.
Сравнили 3 с 4.
Пусть для сравнения 1 с 2 получили p самое маленькое. Мы её сравнили с alpha/6. Убрали 1 со 2, уже учли, осталось 5 гипотез.
Следующая гипотеза после p1 самая маленькая p2 - пусть она будет при сравнении 2 с 3. Для неё сравнение будет с alpha/5.
Следующая p3 с alpha/4
Следующая p4 с alpha/3
...
Последняя гипотеза будет сравниваться с alpha.
Ошибка 1-го рода контролируется, т.к. первая гипотеза сравнивается со всеми остальными.

Пример: 3 попарных сравнения.
Получены p: 0.005, 0.01, 0.02
p1: 0.005 * 3 = 0.015 < 0.05 - H0(1) отклоняем, есть различия
p2: 0.01 * 2 = 0.02 < 0.05 отклоняем
p3: 0.02 * 1 = 0.02 <0.05 отклоняем


Пример со спортсменами (продолжение)
t-критерии нашли, они соответствуют:
p.value у спортсменов, физкультурников и малоактивных: 0.11, 0.00007, 0.0077 (слушать запись).

Критерий Тьюки - тоже критерий для множественных сравнений.
Строят доверительный интервал для разности. Если выходят отличия, то...?
Тут гипотеза такая же, что среднии не отличаются, две группы сравниваем. Хитрость в том, что у критерия Стьюдента - здесь смотрим на разницу средних, делим на разницу отклонений из формулы дисперсионного анализа.
Мощность критерия увеличивается.
Эта величина не по критерию Стьюдента распределяется, а по распределению стьюдентиризированных размахов.

Критерий Тьюки - то же самое, что и к дисперсионному анализу относится - нормальное распределение и однородность дисперсии.
Если одинаковое количество наблюдений, то мощность растёт. Иначе - падает.

Есть ещё Ньюмана-Кейлса - он дополняется ранжированием гипотез по их полученному уровню значимости и ещё групповым ...? Он более мощный, но он слишком часто позволяет ...? Поэтому он не реализован.

Когда нужно сравнивать с контрольной группой (не всегда нужно всех со всеми, а иногда нужно каждую группу с контрольной), тогда количество сравнений уменьшается. Критерии Даннета.
Всего потребуется n - 1 сравнений, где n - количество групп.

Задание на практику:
1 задача про уровень холестирина - есть те, кто занимается спортом (средний по группе) у бегунов трусцой, марафонцев, 70 человек было в каждой группе. Нужно оценить статистическую значимость различий между группами. Есть ..., есть ..., столько-то человек. Просто сравниваем каждую с каждой...

Следующее - мед сёстра работают с разными больными, их на 3 группы разделили, первая группа - самая тяжёлая, третья - самая тяжёлая. Итого 6 групп по 16 медсестёр в каждой. У каждой своя степень выгорания (опустошённости) была. Средняя такая-то (там есть пропущенная запятая).
6 групп - всех сравнивать со всеми не нужно, просто сделать дисперсионный анализ - он может что-то сказать. А если есть, то всех сравнивать.

Следующее - таблица с данными по воздуху. Нужно понять, отличается ли температура воздуха от той, что была в сентябре?
Далее код R рассматриваем.



#### Вывод

#### Ссылки
Source Material and other similar notes