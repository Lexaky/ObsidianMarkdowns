**Created at** [15-11-2025 10:47]
**Tags**: #Database 
# Не стандартизированный SQL


#### Рассматриваемое знание
Не реляционные запросы в языке SQL - те запросы, которые нельзя представить в каком-то выде в качестве выражения реляционной алгебры.\
К стандарт средствам SQL относятся нереляц средства: WITH RECURSIVE, оконные функции, пользовательские переменные (их нельзя описать через реляц алгебру).
Разные базы по-разному интерпретируют переменные.

#### Переменные
[4]
Обозначаются через '@variable', @ читается как (at). 
[5]
[6]
Глобальная о сессионной отличается следующим: глобальные переменные можно запросить списком через SHOW GLOBAL VARIABLES. Глобальная переменная - переменная установленная в данном instance в данном СУБД. Сессионная - которая устанавливается в конкретной сессии, но не в рамках запроса.
Сессия - мы пишем программу, хотим соединиться с БД, нужно создать connection. Сессия - это connection. В рамках одной сессии может выполняться 1 запрос одновременно. Если хотим второй запрос, нужно дождаться первого. Если хотим запустить 2-3-4... запроса, то нужно создать несколько сессий. У каждой сессии свои запросы, они выполняются параллельно.
[7]
[8]
SHOW VARIABLES просто показывает все переменные.
Для чтения различные кодировки всё будет окей - всё преобразуется в utf-8/utf-4. Для записи - под вопросом. Записанные данные будут конвертированы из UTF-8 в cp1251 - то-есть в несколько байт. При записи русских букв могут возникать пропуски.

[9]
Написание row_number без написания самого row_number
[10]
Особенности работы с переменной
Что будет, если внутри какая-то переменная ещё раз переопределяться? 
Если мы когда-то объявили переменную (в начале), то она сразу же знает о ней. Причём важную роль играет высота начала текста. Сами переменные глубину структуры не понимают, они работают только с состояниями.
[11]
Медиана
[12]
Как можно применять переменные
[13]
Аккумулятивная сумма
[14]
Количество предметов в группах
[15]
и [16]
Запросы, которые работают долго даже в оконных функциях

Необходимо из 2млн строк получить 40 значений сэмплированных. 
**Задача**: придумать запрос быстрого семплирования при малом количестве семплов. Нужно найти алгоритм и написать его на SQL (классический алгоритм семплирования) - как его написать на SQL так, чтобы он не бегал по всем и не перебирал всё?


#### Вывод

#### Ссылки
[[Оконные функции и не стандартизированный SQL]]