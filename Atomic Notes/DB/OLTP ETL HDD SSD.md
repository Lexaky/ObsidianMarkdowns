Created at: [13-12-2025 10:00]
**Tags**: #Database 

Рассматриваемое знание
Есть OLTP и OLAP - два типа разделённых бд. Одна для многих операций мелких, вторая для одной большой аналитической. Современные БД пришли к тому, что могут делать это одновременно. Такие БД называются Потоковыми, они позволяют обрабатывать OLAP запросы в реальном времени.
ETL (Extract Transform Load - три операции) ELT (Extract Load Transform - сначала достали, загрузили, потом преобразовали).
Сейчас в Oracle или современных БД можно реализовать ETL ценой...
HDD для потоковой записи не предназначены, т.к. данные записываются и читаются блоками (последовательно). В C языке были операции fread, fwrite, но по сути базовым является буферизованный файл, который позволяет считывать большими отсеками, не 1 байт, а целый байт - сектор, который за раз считывается и за раз записывается. На жёстком диске нет операции записи байт, только секторы.
Считывание сектора (Extract)
Обработка сектора (Transform)
Запись сектора (Load) 
Хдд хоть и попадает по ETL, но это не совсем так верно.
Сектор = блок (запись блочная, битовая).
На таких устройствах должен быть буфер в памяти. Он содержит блоки чтения записи, мы с ними работаем и потом их описываем.
В БД такой механизм называется механизм отложенной (утверждающей) записи WAL (Waiting ...)
Для того, чтобы что-то делать с БД, необходимо исправить кусок БД в памяти, и потом только её уже нести в реальный мир (на реальный диск).
Чтобы работать с потоковыми записями (бд), нужно использовать 
1
По умолчанию нужна буферная зона (это называется где-то журналируемая запись). При фазе коммит происходит попытка записать транзакции на диск. Почему только в этот момент? - потому что самая затратная операция для хдд - это запись. Проще всё заранее в памяти сделать и блоком закинуть на диск. Блоком закидывается по определению коммита.

Общего порядка применения коммитов нет, вообще как они пришли по времени, так они и пройдут. Мы не будем знать, в какой момент запись была первой, а когда вторая.

Современные хдд обладают ссд-шниками, которые тоже всё буферизируют. Чтобы убедиться, что запись на диск внесена - нужно прочитать диск. Если будет ещё одна транзакция чтения, желательно отдать информацию

Read для правого устройства создаётся.


materialized view - идея, похожая на эту виртуализацию.
Одна транзакция требует атомарности, MV не могут быть вместо виртуальных таблиц, нарушается атомарность.
Атомарность практически не реализуется, одновременно учитывая все ACID, нужно перейти к BASE.
Не согласованная версия (основная бд) и есть согласованная БД (правая картинка).
Мы читаем из согласованной БД, вторая - буфер, мы в неё пишем, но никогда из неё не читаем.

SSD работает не по секторам, а по адресуемым пространствам.
1) По мере заполнения ссд скорость чтения и записи падает
	1) Под ОС нужно оставлять 15-20% свободного ссд. Нужно разворачивать файловую структуру ей. Когда в одной ячейке памяти хранился 1 бит, то этого (SSD) не было. 
2) Этапы уплотнения информации.
	1) Чтение происходит одинаково быстро при любом уплотнении. Но запись при разном уплотнении имеет разную скорость.
	2) Ранее в одной ячейке был либо 1, либо 0. Потом появился вариант записывать 2 бита информации. Ячейка больше не стала, но теперь можно писать 2 бита. Сначала эти ячейки работают в режиме Single bit mode. Допустим, записали в такую ячейку 1, а следующая запись будет в следующую ячейку, а не в эту двойную. В итоге мы заполним последнюю ячейку памяти, и после этого будем писать в уплотнённую зону.
	3) Современные ссд могут быть 4-битными.
	4) ССД лучше забивать в 2 раза (не более 50%), чтобы скорость записи не падала.

Materialized View и MV на БД.
В потоковых СУБД хранятся обычно логи пользователей. Они нужны
Логи - Clickstream (поток кликов) - фактически они показывают историю действия пользователей. Это может быть либо непрерывный поток записей, либо поток событий. Их обычно организуют в приложениях. Поток событий отличается от потока кликов тем, что события могут быть как единичным кликом, так и набором последовательных кликов.
Чтобы удалить файл с диска ноутбука, недостаточно будет кликнуть delete, нужно будет подтвердить удаление, потом очистить корзину. При этом в clickstream будут 5 кликов нарисованы с перерывом на действия пользователей. А в потоке событий это будет единое событие.

Google сделали web view - браузер, который встраивается в приложение. Многие из тех приложений на Android - по сути это браузер, который открывается вместо приложения.
На web нельзя сформировать поток событий. Только в приложении.
На web нет данных о платформе, на которой мы запускаемся. Только информация в заголовках запроса.

ДЗ:
У кликхауса есть справка на сайте. Нужно прочитать:
Как создаётся/делется/считывается Materialized View
Операции с массивами в кликхаусе (они отличаются такой записью: "[ ]")
Из книги потоковые БД прочитать конвеерную обработку (1 и 2 главы). Самые полезные там - это ограничения, что мы с помощью потоковой обработки не можем. В книге есть базы очень похожие на кликхаус, но самого кликхауса нет.
